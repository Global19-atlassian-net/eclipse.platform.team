<?xml version="1.0"?>
<project name="Build Team and CVS plugins" basedir="." default="init">

  <property name="root" value="${basedir}/.."/>
  <property name="temp" value="${root}/__temp"/>
  <property name="plugins" value="${temp}/eclipse/plugins"/>
  <property name="versionSuffix" value="_2.1.0"/>

  <target name="init">
    <tstamp/>

    <delete dir="${temp}"/>
    <mkdir dir="${plugins}"/>

    <antcall target="org.eclipse.team.core"/>
    <antcall target="org.eclipse.team.ui"/>
    <antcall target="org.eclipse.team.cvs.core"/>
    <antcall target="org.eclipse.team.cvs.ui"/>
    <antcall target="org.eclipse.team.cvs.ssh"/>
    <antcall target="org.eclipse.team.cvs.ssh2"/>

    <zip zipfile="${basedir}/selfhost${DSTAMP}.zip"
       basedir="${temp}"
    />

    <delete dir="${temp}"/>
    <eclipse.refreshLocal resource="org.eclipse.team.tests.cvs.core"/>
  </target>

  <target name="org.eclipse.team.core">
    <antcall target="buildPlugin">
      <param name="pluginName" value="org.eclipse.team.core" />
      <param name="jarName" value="team.jar" />
    </antcall>
  </target>

  <target name="org.eclipse.team.ui">
    <antcall target="buildPlugin">
      <param name="pluginName" value="org.eclipse.team.ui" />
      <param name="jarName" value="teamui.jar" />
    </antcall>
  </target>

  <target name="org.eclipse.team.cvs.core">
    <antcall target="buildPlugin">
      <param name="pluginName" value="org.eclipse.team.cvs.core" />
      <param name="jarName" value="cvs.jar" />
    </antcall>
  </target>

  <target name="org.eclipse.team.cvs.ui">
    <antcall target="buildPlugin">
      <param name="pluginName" value="org.eclipse.team.cvs.ui" />
      <param name="jarName" value="teamcvsui.jar" />
    </antcall>
  </target>

  <target name="org.eclipse.team.cvs.ssh">
    <antcall target="buildPlugin">
      <param name="pluginName" value="org.eclipse.team.cvs.ssh" />
      <param name="jarName" value="teamcvsssh.jar" />
    </antcall>
  </target>
  
  <target name="org.eclipse.team.cvs.ssh2">
    <antcall target="buildPlugin">
      <param name="pluginName" value="org.eclipse.team.cvs.ssh2" />
      <param name="jarName" value="teamcvsssh2.jar" />
    </antcall>
  </target>
          
  <target name="buildPlugin">
    <copy todir="${plugins}/${pluginName}${versionSuffix}">
      <fileset dir="${root}/${pluginName}"/>
    </copy>
    <jar jarfile="${plugins}/${pluginName}${versionSuffix}/${jarName}"
         basedir="${plugins}/${pluginName}${versionSuffix}/bin"
    />
    <delete dir="${plugins}/${pluginName}${versionSuffix}/bin"/>
  </target>

</project>